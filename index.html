<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory Manager</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Plus, Edit2, Trash2, Search, Download, ArrowLeft, Package, X, Check, ChevronRight } = lucide;

    const STORAGE_KEY = "visual_inventory_v1";
    const uid = () => Math.random().toString(36).slice(2,9);
    const ROOM_COLORS = [
      "from-blue-400 to-blue-600","from-purple-400 to-purple-600","from-green-400 to-green-600",
      "from-orange-400 to-orange-600","from-pink-400 to-pink-600","from-teal-400 to-teal-600",
      "from-red-400 to-red-600","from-indigo-400 to-indigo-600","from-yellow-400 to-yellow-600","from-cyan-400 to-cyan-600"
    ];

    function Modal({ title, onClose, children }) {
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4" style={{background:"rgba(0,0,0,0.6)"}}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <div className="flex items-center justify-between p-5 border-b">
              <h2 className="font-bold text-lg">{title}</h2>
              <button onClick={onClose} className="p-1 rounded-lg hover:bg-gray-100"><X size={18}/></button>
            </div>
            <div className="p-5">{children}</div>
          </div>
        </div>
      );
    }

    function SimpleForm({ label, initial="", onSave, onClose, extra }) {
      const [val, setVal] = useState(initial);
      const [ext, setExt] = useState(extra?.initial || {});
      return (
        <div className="space-y-3">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">{label} Name *</label>
            <input autoFocus className="w-full border rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400"
              value={val} onChange={e=>setVal(e.target.value)}
              onKeyDown={e=>e.key==="Enter"&&val.trim()&&onSave(val.trim(),ext)}
              placeholder={`Enter ${label.toLowerCase()} name`}/>
          </div>
          {extra?.fields?.map(f => (
            <div key={f.key}>
              <label className="block text-sm font-medium text-gray-700 mb-1">{f.label}</label>
              {f.type==="textarea"
                ? <textarea className="w-full border rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none" rows={2}
                    value={ext[f.key]||""} onChange={e=>setExt(p=>({...p,[f.key]:e.target.value}))} placeholder={f.placeholder}/>
                : <input type={f.type||"text"} className="w-full border rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400"
                    value={ext[f.key]??""} onChange={e=>setExt(p=>({...p,[f.key]:e.target.value}))} placeholder={f.placeholder}/>
              }
            </div>
          ))}
          <div className="flex gap-2 pt-1">
            <button onClick={onClose} className="flex-1 px-4 py-2 rounded-xl border text-sm font-medium hover:bg-gray-50">Cancel</button>
            <button disabled={!val.trim()} onClick={()=>onSave(val.trim(),ext)}
              className="flex-1 px-4 py-2 rounded-xl bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 disabled:opacity-40 flex items-center justify-center gap-1">
              <Check size={14}/> Save
            </button>
          </div>
        </div>
      );
    }

    function LocationCard({ loc, onSelect, onEdit, onDelete }) {
      const totalItems = (loc.rooms||[]).flatMap(r=>(r.shelves||[]).flatMap(s=>(s.layers||[]).flatMap(l=>l.items||[]))).length;
      return (
        <div onClick={()=>onSelect(loc)} className="group relative bg-white rounded-2xl border-2 border-gray-100 hover:border-indigo-300 shadow-sm hover:shadow-lg transition-all cursor-pointer overflow-hidden">
          <div className="h-2 bg-gradient-to-r from-indigo-500 to-purple-500"/>
          <div className="p-5">
            <div className="flex items-start justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-indigo-100 flex items-center justify-center text-xl">üè¢</div>
                <div>
                  <h3 className="font-bold text-gray-900">{loc.name}</h3>
                  <p className="text-xs text-gray-400">{(loc.rooms||[]).length} rooms ¬∑ {totalItems} items</p>
                </div>
              </div>
              <ChevronRight size={18} className="text-gray-300 group-hover:text-indigo-400 transition-colors mt-1"/>
            </div>
            <div className="mt-4 flex gap-1">
              {(loc.rooms||[]).slice(0,6).map((r,i)=>(
                <div key={r.id} className={`h-1.5 flex-1 rounded-full bg-gradient-to-r ${ROOM_COLORS[i%ROOM_COLORS.length]} opacity-60`}/>
              ))}
              {(loc.rooms||[]).length === 0 && <div className="h-1.5 flex-1 rounded-full bg-gray-100"/>}
            </div>
          </div>
          <div className="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity" onClick={e=>e.stopPropagation()}>
            <button onClick={()=>onEdit(loc)} className="p-1.5 rounded-lg bg-white shadow border hover:bg-gray-50"><Edit2 size={12}/></button>
            <button onClick={()=>onDelete(loc.id)} className="p-1.5 rounded-lg bg-white shadow border hover:bg-red-50 text-red-400"><Trash2 size={12}/></button>
          </div>
        </div>
      );
    }

    function BuildingView({ loc, onSelectRoom, onAddRoom, onEditRoom, onDeleteRoom }) {
      const rooms = loc.rooms || [];
      return (
        <div>
          <div className="mb-6 flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-gray-900">{loc.name}</h2>
              <p className="text-sm text-gray-400">{rooms.length} rooms ‚Äî click a room to manage its inventory</p>
            </div>
            <button onClick={onAddRoom} className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-indigo-700 shadow">
              <Plus size={15}/> Add Room
            </button>
          </div>
          <div className="bg-gray-100 rounded-3xl p-6 border-4 border-gray-200 min-h-64">
            <div className="flex items-center gap-2 mb-4">
              <div className="h-px flex-1 bg-gray-300"/>
              <span className="text-xs text-gray-400 font-medium px-2">üè¢ FLOOR PLAN</span>
              <div className="h-px flex-1 bg-gray-300"/>
            </div>
            {rooms.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-16 text-gray-400">
                <div className="text-5xl mb-3">üö™</div>
                <p className="text-sm font-medium">No rooms yet</p>
                <p className="text-xs mt-1">Click "Add Room" to place the first room</p>
              </div>
            ) : (
              <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
                {rooms.map((room, i) => {
                  const itemCount = (room.shelves||[]).flatMap(s=>(s.layers||[]).flatMap(l=>l.items||[])).length;
                  const colorClass = ROOM_COLORS[i % ROOM_COLORS.length];
                  return (
                    <div key={room.id} onClick={()=>onSelectRoom(room)}
                      className="group relative rounded-2xl overflow-hidden cursor-pointer hover:scale-105 transition-transform shadow-md hover:shadow-xl">
                      <div className={`bg-gradient-to-br ${colorClass} p-4 min-h-28 flex flex-col justify-between`}>
                        <div className="flex justify-between items-start">
                          <span className="text-white/80 text-xs font-medium uppercase tracking-wide">Room</span>
                          <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity" onClick={e=>e.stopPropagation()}>
                            <button onClick={()=>onEditRoom(room)} className="p-1 rounded-lg bg-white/20 hover:bg-white/40 text-white"><Edit2 size={10}/></button>
                            <button onClick={()=>onDeleteRoom(room.id)} className="p-1 rounded-lg bg-white/20 hover:bg-red-400 text-white"><Trash2 size={10}/></button>
                          </div>
                        </div>
                        <div>
                          <p className="text-white font-bold text-base leading-tight">{room.name}</p>
                          <p className="text-white/70 text-xs mt-0.5">{(room.shelves||[]).length} shelves ¬∑ {itemCount} items</p>
                        </div>
                        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-8 bg-white/20 rounded-t-lg border-2 border-white/30"/>
                      </div>
                    </div>
                  );
                })}
                <button onClick={onAddRoom} className="rounded-2xl border-2 border-dashed border-gray-300 min-h-28 flex flex-col items-center justify-center gap-2 text-gray-400 hover:border-indigo-400 hover:text-indigo-500 hover:bg-indigo-50 transition-all">
                  <Plus size={22}/><span className="text-xs font-medium">Add Room</span>
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    function RoomView({ room, onSelectShelf, onAddShelf, onEditShelf, onDeleteShelf }) {
      const shelves = room.shelves || [];
      return (
        <div>
          <div className="mb-6 flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-gray-900">{room.name}</h2>
              <p className="text-sm text-gray-400">{shelves.length} shelves ‚Äî click a shelf to manage layers & items</p>
            </div>
            <button onClick={onAddShelf} className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-green-700 shadow">
              <Plus size={15}/> Add Shelf
            </button>
          </div>
          <div className="bg-amber-50 rounded-3xl p-6 border-4 border-amber-100">
            <div className="flex items-center gap-2 mb-4">
              <div className="h-px flex-1 bg-amber-200"/>
              <span className="text-xs text-amber-600 font-medium px-2">üóÑÔ∏è SHELF UNIT</span>
              <div className="h-px flex-1 bg-amber-200"/>
            </div>
            {shelves.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-16 text-amber-400">
                <div className="text-5xl mb-3">üì¶</div>
                <p className="text-sm font-medium">No shelves yet</p>
              </div>
            ) : (
              <div className="space-y-2">
                {shelves.map((shelf,i)=>{
                  const itemCount=(shelf.layers||[]).flatMap(l=>l.items||[]).length;
                  return (
                    <div key={shelf.id} onClick={()=>onSelectShelf(shelf)}
                      className="group relative bg-white rounded-xl border-2 border-amber-200 hover:border-green-400 px-5 py-3 cursor-pointer flex items-center gap-4 hover:shadow-md transition-all">
                      <div className="w-7 h-7 rounded-lg bg-amber-100 text-amber-700 text-xs font-bold flex items-center justify-center shrink-0">{i+1}</div>
                      <div className="flex-1">
                        <p className="font-semibold text-gray-800">{shelf.name}</p>
                        <p className="text-xs text-gray-400">{(shelf.layers||[]).length} layers ¬∑ {itemCount} items</p>
                      </div>
                      <div className="hidden sm:flex gap-1 items-center">
                        {(shelf.layers||[]).slice(0,4).map((_,j)=>(
                          <div key={j} className="w-2 h-6 rounded-sm bg-green-200"/>
                        ))}
                      </div>
                      <ChevronRight size={16} className="text-gray-300 group-hover:text-green-500"/>
                      <div className="absolute right-10 top-1/2 -translate-y-1/2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity" onClick={e=>e.stopPropagation()}>
                        <button onClick={()=>onEditShelf(shelf)} className="p-1 rounded-lg bg-gray-100 hover:bg-gray-200"><Edit2 size={10}/></button>
                        <button onClick={()=>onDeleteShelf(shelf.id)} className="p-1 rounded-lg bg-gray-100 hover:bg-red-100 text-red-400"><Trash2 size={10}/></button>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
            <div className="mt-3 h-3 bg-amber-200 rounded-xl"/>
          </div>
        </div>
      );
    }

    function ShelfView({ shelf, onUpdate }) {
      const [layers, setLayers] = useState(shelf.layers || []);
      const [modal, setModal] = useState(null);

      useEffect(()=>{ onUpdate({...shelf, layers}); }, [layers]);

      const addLayer = (name) => { setLayers(p=>[...p,{id:uid(),name,items:[]}]); setModal(null); };
      const editLayer = (id,name) => { setLayers(p=>p.map(l=>l.id===id?{...l,name}:l)); setModal(null); };
      const deleteLayer = (id) => { if(confirm("Delete layer?")) setLayers(p=>p.filter(l=>l.id!==id)); };
      const addItem = (layerId,name,ext) => { setLayers(p=>p.map(l=>l.id===layerId?{...l,items:[...l.items,{id:uid(),name,quantity:Number(ext.quantity)||0,notes:ext.notes||""}]}:l)); setModal(null); };
      const editItem = (layerId,item,name,ext) => { setLayers(p=>p.map(l=>l.id===layerId?{...l,items:l.items.map(i=>i.id===item.id?{...i,name,quantity:Number(ext.quantity)||0,notes:ext.notes||""}:i)}:l)); setModal(null); };
      const deleteItem = (layerId,itemId) => { setLayers(p=>p.map(l=>l.id===layerId?{...l,items:l.items.filter(i=>i.id!==itemId)}:l)); };

      return (
        <div>
          <div className="mb-6 flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-gray-900">{shelf.name}</h2>
              <p className="text-sm text-gray-400">{layers.length} layers</p>
            </div>
            <button onClick={()=>setModal({type:"addLayer"})} className="flex items-center gap-2 bg-orange-500 text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-orange-600 shadow">
              <Plus size={15}/> Add Layer
            </button>
          </div>
          <div className="space-y-4">
            {layers.length===0 && (
              <div className="text-center py-16 text-gray-400">
                <div className="text-5xl mb-3">üóÇÔ∏è</div>
                <p className="text-sm">No layers yet ‚Äî add a layer to start adding items</p>
              </div>
            )}
            {layers.map((layer,i)=>(
              <div key={layer.id} className="bg-white rounded-2xl border-2 border-orange-100 overflow-hidden shadow-sm">
                <div className="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-orange-50 to-amber-50 border-b border-orange-100">
                  <div className="w-7 h-7 rounded-lg bg-orange-500 text-white text-xs font-bold flex items-center justify-center">{i+1}</div>
                  <span className="font-semibold text-gray-800 flex-1">{layer.name}</span>
                  <span className="text-xs text-gray-400">{layer.items.length} items</span>
                  <button onClick={()=>setModal({type:"addItem",layerId:layer.id})} className="p-1.5 rounded-lg bg-orange-100 hover:bg-orange-200 text-orange-600"><Plus size={13}/></button>
                  <button onClick={()=>setModal({type:"editLayer",layer})} className="p-1.5 rounded-lg hover:bg-gray-100 text-gray-400"><Edit2 size={13}/></button>
                  <button onClick={()=>deleteLayer(layer.id)} className="p-1.5 rounded-lg hover:bg-red-50 text-gray-400 hover:text-red-400"><Trash2 size={13}/></button>
                </div>
                <div className="p-3">
                  {layer.items.length===0 ? (
                    <button onClick={()=>setModal({type:"addItem",layerId:layer.id})} className="w-full py-4 border-2 border-dashed border-gray-200 rounded-xl text-gray-400 text-sm hover:border-orange-300 hover:text-orange-400 transition-all">
                      + Add first item
                    </button>
                  ) : (
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                      {layer.items.map(item=>(
                        <div key={item.id} className="group flex items-start gap-2 bg-gray-50 rounded-xl px-3 py-2 border border-gray-100">
                          <Package size={14} className="text-gray-400 mt-0.5 shrink-0"/>
                          <div className="flex-1 min-w-0">
                            <p className="font-medium text-sm text-gray-800 truncate">{item.name}</p>
                            <p className="text-xs text-gray-400">Qty: <span className="font-bold text-gray-600">{item.quantity}</span>{item.notes && ` ¬∑ ${item.notes}`}</p>
                          </div>
                          <div className="flex gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0">
                            <button onClick={()=>setModal({type:"editItem",layerId:layer.id,item})} className="p-1 rounded hover:bg-gray-200 text-gray-400"><Edit2 size={11}/></button>
                            <button onClick={()=>deleteItem(layer.id,item.id)} className="p-1 rounded hover:bg-red-100 text-gray-400 hover:text-red-400"><Trash2 size={11}/></button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
          {modal?.type==="addLayer" && <Modal title="Add Layer" onClose={()=>setModal(null)}><SimpleForm label="Layer" onSave={name=>addLayer(name)} onClose={()=>setModal(null)}/></Modal>}
          {modal?.type==="editLayer" && <Modal title="Edit Layer" onClose={()=>setModal(null)}><SimpleForm label="Layer" initial={modal.layer.name} onSave={name=>editLayer(modal.layer.id,name)} onClose={()=>setModal(null)}/></Modal>}
          {modal?.type==="addItem" && <Modal title="Add Item" onClose={()=>setModal(null)}>
            <SimpleForm label="Item" onSave={(name,ext)=>addItem(modal.layerId,name,ext)} onClose={()=>setModal(null)}
              extra={{fields:[{key:"quantity",label:"Quantity",type:"number",placeholder:"0"},{key:"notes",label:"Notes",type:"textarea",placeholder:"Optional"}]}}/>
          </Modal>}
          {modal?.type==="editItem" && <Modal title="Edit Item" onClose={()=>setModal(null)}>
            <SimpleForm label="Item" initial={modal.item.name} onSave={(name,ext)=>editItem(modal.layerId,modal.item,name,ext)} onClose={()=>setModal(null)}
              extra={{initial:{quantity:modal.item.quantity,notes:modal.item.notes},fields:[{key:"quantity",label:"Quantity",type:"number",placeholder:"0"},{key:"notes",label:"Notes",type:"textarea",placeholder:"Optional"}]}}/>
          </Modal>}
        </div>
      );
    }

    function Breadcrumb({ crumbs, onNavigate }) {
      return (
        <div className="flex items-center gap-1 text-sm text-gray-500 flex-wrap">
          {crumbs.map((c,i)=>(
            <span key={i} className="flex items-center gap-1">
              {i>0 && <ChevronRight size={13} className="text-gray-300"/>}
              <button onClick={()=>onNavigate(i)} className={i===crumbs.length-1?"font-bold text-gray-900":"hover:text-indigo-600 transition-colors"}>
                {c.label}
              </button>
            </span>
          ))}
        </div>
      );
    }

    function App() {
      const [data, setData] = useState(() => {
        try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {locations:[]}; } catch { return {locations:[]}; }
      });
      const [nav, setNav] = useState([]);
      const [modal, setModal] = useState(null);
      const [search, setSearch] = useState("");

      useEffect(()=>{ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }, [data]);

      const currentLoc = nav.length>0 ? data.locations.find(l=>l.id===nav[0]?.id) : null;
      const currentRoom = nav.length>1 ? currentLoc?.rooms?.find(r=>r.id===nav[1]?.id) : null;
      const currentShelf = nav.length>2 ? currentRoom?.shelves?.find(s=>s.id===nav[2]?.id) : null;

      const crumbs = [
        {label:"üì¶ Locations"},
        ...(currentLoc?[{label:currentLoc.name}]:[]),
        ...(currentRoom?[{label:currentRoom.name}]:[]),
        ...(currentShelf?[{label:currentShelf.name}]:[]),
      ];

      const navigateTo = (idx) => setNav(nav.slice(0,idx));
      const mutate = (fn) => setData(prev => { const d = JSON.parse(JSON.stringify(prev)); fn(d); return d; });

      const addLocation = (name) => { mutate(d=>d.locations.push({id:uid(),name,rooms:[]})); setModal(null); };
      const editLocation = (id,name) => { mutate(d=>{const l=d.locations.find(x=>x.id===id);if(l)l.name=name;}); setModal(null); };
      const deleteLocation = (id) => { if(!confirm("Delete location?"))return; mutate(d=>{d.locations=d.locations.filter(x=>x.id!==id);}); };

      const addRoom = (name) => { mutate(d=>d.locations.find(x=>x.id===currentLoc.id).rooms.push({id:uid(),name,shelves:[]})); setModal(null); };
      const editRoom = (id,name) => { mutate(d=>{const r=d.locations.find(x=>x.id===currentLoc.id).rooms.find(x=>x.id===id);if(r)r.name=name;}); setModal(null); };
      const deleteRoom = (id) => { if(!confirm("Delete room?"))return; mutate(d=>{const l=d.locations.find(x=>x.id===currentLoc.id);l.rooms=l.rooms.filter(x=>x.id!==id);}); };

      const addShelf = (name) => { mutate(d=>d.locations.find(x=>x.id===currentLoc.id).rooms.find(x=>x.id===currentRoom.id).shelves.push({id:uid(),name,layers:[]})); setModal(null); };
      const editShelf = (id,name) => { mutate(d=>{const s=d.locations.find(x=>x.id===currentLoc.id).rooms.find(x=>x.id===currentRoom.id).shelves.find(x=>x.id===id);if(s)s.name=name;}); setModal(null); };
      const deleteShelf = (id) => { if(!confirm("Delete shelf?"))return; mutate(d=>{const r=d.locations.find(x=>x.id===currentLoc.id).rooms.find(x=>x.id===currentRoom.id);r.shelves=r.shelves.filter(x=>x.id!==id);}); };

      const updateShelf = (updatedShelf) => {
        mutate(d=>{
          const r=d.locations.find(x=>x.id===currentLoc.id).rooms.find(x=>x.id===currentRoom.id);
          const idx=r.shelves.findIndex(x=>x.id===updatedShelf.id);
          if(idx>-1) r.shelves[idx]=updatedShelf;
        });
      };

      const exportCSV = () => {
        const rows=[["Location","Room","Shelf","Layer","Item","Quantity","Notes"]];
        for(const loc of data.locations) for(const room of loc.rooms||[]) for(const shelf of room.shelves||[]) for(const layer of shelf.layers||[]) for(const item of layer.items||[])
          rows.push([loc.name,room.name,shelf.name,layer.name,item.name,item.quantity,item.notes||""]);
        const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
        const a=document.createElement("a");a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));a.download="inventory.csv";a.click();
      };

      const searchResults = search.trim() ? (() => {
        const q = search.toLowerCase();
        const results = [];
        for(const loc of data.locations) for(const room of loc.rooms||[]) for(const shelf of room.shelves||[]) for(const layer of shelf.layers||[]) for(const item of layer.items||[])
          if(item.name.toLowerCase().includes(q)||item.notes?.toLowerCase().includes(q))
            results.push({loc:loc.name,room:room.name,shelf:shelf.name,layer:layer.name,item});
        return results;
      })() : null;

      return (
        <div className="min-h-screen bg-gray-50">
          <div className="bg-white border-b sticky top-0 z-40 shadow-sm">
            <div className="max-w-4xl mx-auto px-4 py-3 flex items-center gap-3">
              {nav.length>0 && <button onClick={()=>setNav(p=>p.slice(0,-1))} className="p-2 rounded-xl hover:bg-gray-100 text-gray-500"><ArrowLeft size={18}/></button>}
              <div className="flex-1"><Breadcrumb crumbs={crumbs} onNavigate={navigateTo}/></div>
              <div className="relative">
                <Search size={14} className="absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400"/>
                <input className="pl-7 pr-3 py-1.5 text-sm border rounded-xl w-36 sm:w-52 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  placeholder="Search items..." value={search} onChange={e=>setSearch(e.target.value)}/>
              </div>
              <button onClick={exportCSV} className="p-2 rounded-xl border hover:bg-gray-50 text-gray-500" title="Export CSV"><Download size={16}/></button>
            </div>
          </div>

          <div className="max-w-4xl mx-auto px-4 py-6">
            {searchResults && (
              <div className="mb-6">
                <h3 className="font-bold text-gray-700 mb-3">Results for "{search}" ({searchResults.length})</h3>
                {searchResults.length===0 ? <p className="text-gray-400 text-sm">No items found.</p> : (
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                    {searchResults.map((r,i)=>(
                      <div key={i} className="bg-white rounded-xl border px-4 py-3 flex items-start gap-3">
                        <Package size={16} className="text-indigo-400 mt-0.5 shrink-0"/>
                        <div>
                          <p className="font-semibold text-gray-800">{r.item.name} <span className="text-xs font-normal text-gray-400">√ó{r.item.quantity}</span></p>
                          <p className="text-xs text-gray-400">{r.loc} ‚Üí {r.room} ‚Üí {r.shelf} ‚Üí {r.layer}</p>
                          {r.item.notes && <p className="text-xs text-gray-400 italic">{r.item.notes}</p>}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {nav.length===0 && !searchResults && (
              <>
                <div className="flex items-center justify-between mb-5">
                  <h1 className="text-2xl font-bold text-gray-900">Locations</h1>
                  <button onClick={()=>setModal({type:"addLoc"})} className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-indigo-700 shadow">
                    <Plus size={15}/> Add Location
                  </button>
                </div>
                {data.locations.length===0 ? (
                  <div className="text-center py-24 text-gray-400">
                    <div className="text-6xl mb-4">üè¢</div>
                    <p className="font-medium">No locations yet</p>
                    <p className="text-sm mt-1">Add a location to get started</p>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {data.locations.map(loc=>(
                      <LocationCard key={loc.id} loc={loc} onSelect={l=>setNav([{id:l.id}])}
                        onEdit={l=>setModal({type:"editLoc",loc:l})} onDelete={deleteLocation}/>
                    ))}
                  </div>
                )}
              </>
            )}

            {nav.length===1 && currentLoc && !searchResults && (
              <BuildingView loc={currentLoc} onSelectRoom={r=>setNav(p=>[...p,{id:r.id}])}
                onAddRoom={()=>setModal({type:"addRoom"})} onEditRoom={r=>setModal({type:"editRoom",room:r})} onDeleteRoom={deleteRoom}/>
            )}
            {nav.length===2 && currentRoom && !searchResults && (
              <RoomView room={currentRoom} onSelectShelf={s=>setNav(p=>[...p,{id:s.id}])}
                onAddShelf={()=>setModal({type:"addShelf"})} onEditShelf={s=>setModal({type:"editShelf",shelf:s})} onDeleteShelf={deleteShelf}/>
            )}
            {nav.length===3 && currentShelf && !searchResults && (
              <ShelfView shelf={currentShelf} onUpdate={updateShelf}/>
            )}
          </div>

          {modal?.type==="addLoc" && <Modal title="Add Location" onClose={()=>setModal(null)}><SimpleForm label="Location" onSave={addLocation} onClose={()=>setModal(null)}/></Modal>}
          {modal?.type==="editLoc" && <Modal title="Edit Location" onClose={()=>setModal(null)}><SimpleForm label="Location" initial={modal.loc.name} onSave={n=>editLocation(modal.loc.id,n)} onClose={()=>setModal(null)}/></Modal>}
          {modal?.type==="addRoom" && <Modal title="Add Room" onClose={()=>setModal(null)}><SimpleForm label="Room" onSave={addRoom} onClose={()=>setModal(null)}/></Modal>}
          {modal?.type==="editRoom" && <Modal title="Edit Room" onClose={()=>setModal(null)}><SimpleForm label="Room" initial={modal.room.name} onSave={n=>editRoom(modal.room.id,n)} onClose={()=>setModal(null)}/></Modal>}
          {modal?.type==="addShelf" && <Modal title="Add Shelf" onClose={()=>setModal(null)}><SimpleForm label="Shelf" onSave={addShelf} onClose={()=>setModal(null)}/></Modal>}
          {modal?.type==="editShelf" && <Modal title="Edit Shelf" onClose={()=>setModal(null)}><SimpleForm label="Shelf" initial={modal.shelf.name} onSave={n=>editShelf(modal.shelf.id,n)} onClose={()=>setModal(null)}/></Modal>}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
